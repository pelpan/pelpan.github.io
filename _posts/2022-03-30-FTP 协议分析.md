---
layout:     post
title:      FTPåè®®åˆ†æ
subtitle:   TCP/IPåè®®
date:       2022-03-30
author:     Pele
header-img: img/bg-ftp3.webp
catalog: true
tags:
    - TCP/IP
---

# FTP åè®®åˆ†æ

>  **æ–‡ä»¶ä¼ è¾“åè®®**ï¼ˆè‹±è¯­ï¼š**F**ile **T**ransfer **P**rotocolï¼Œç¼©å†™ï¼š**FTP**ï¼‰æ˜¯ä¸€ä¸ªç”¨äºåœ¨è®¡ç®—æœºç½‘ç»œä¸Šåœ¨[å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨](https://zh.wikipedia.org/wiki/ä¸»å¾å¼æ¶æ§‹)ä¹‹é—´è¿›è¡Œæ–‡ä»¶ä¼ è¾“çš„[åº”ç”¨å±‚](https://zh.wikipedia.org/wiki/åº”ç”¨å±‚)[åè®®](https://zh.wikipedia.org/wiki/ç½‘ç»œä¼ è¾“åè®®)ã€‚æ–‡ä»¶ä¼ é€ï¼ˆfile transferï¼‰å’Œæ–‡ä»¶è®¿é—®ï¼ˆfile accessï¼‰ä¹‹é—´çš„åŒºåˆ«åœ¨äºï¼šå‰è€…ç”±FTPæä¾›ï¼Œåè€…ç”±å¦‚[NFS](https://zh.wikipedia.org/wiki/ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ)ç­‰åº”ç”¨ç³»ç»Ÿæä¾›[[1\]](https://zh.wikipedia.org/wiki/æ–‡ä»¶ä¼ è¾“åè®®#cite_note-1)ã€‚[RFC 959](https://tools.ietf.org/html/rfc959) å®šä¹‰äº†æ­¤è§„èŒƒã€‚ â€”â€” Wikipedia



### FTPå®ç°çš„ç›®æ ‡

1. ä¿ƒè¿›æ–‡ä»¶çš„å…±äº«ï¼ˆè®¡ç®—æœºç¨‹åºæˆ–æ•°æ®ï¼‰

2. é¼“åŠ±é—´æ¥æˆ–è€…éšå¼çš„ä½¿ç”¨è¿œç¨‹è®¡ç®—æœº

3. å‘ç”¨æˆ·å±è”½ä¸åŒä¸»æœºä¸­å„ç§æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼ˆFile systemï¼‰çš„ç»†èŠ‚

4. å¯é å’Œé«˜æ•ˆçš„ä¼ è¾“æ•°æ®

   

### ä¸»åŠ¨å’Œè¢«åŠ¨æ¨¡å¼

FTPæœ‰ä¸¤ç§ä½¿ç”¨æ¨¡å¼ï¼šä¸»åŠ¨å’Œè¢«åŠ¨ã€‚

ä¸»åŠ¨æ¨¡å¼è¦æ±‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯åŒæ—¶æ‰“å¼€å¹¶ä¸”ç›‘å¬ä¸€ä¸ªç«¯å£ä»¥åˆ›å»ºè¿æ¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯ç”±äºå®‰è£…äº†é˜²ç«å¢™ä¼šäº§ç”Ÿä¸€äº›é—®é¢˜ã€‚æ‰€ä»¥ï¼Œåˆ›ç«‹äº†è¢«åŠ¨æ¨¡å¼ã€‚

è¢«åŠ¨æ¨¡å¼åªè¦æ±‚æœåŠ¡å™¨ç«¯äº§ç”Ÿä¸€ä¸ªç›‘å¬ç›¸åº”ç«¯å£çš„è¿›ç¨‹ï¼Œè¿™æ ·å°±å¯ä»¥ç»•è¿‡å®¢æˆ·ç«¯å®‰è£…äº†é˜²ç«å¢™çš„é—®é¢˜ã€‚



### å®‰å…¨æ€§

FTPä¸æ˜¯ä¸€é¡¹å®‰å…¨çš„åè®®ï¼Œå¹¶ä¸”å…·æœ‰è®¸å¤šå®‰å…¨æ¼æ´[[13\]](https://zh.wikipedia.org/wiki/æ–‡ä»¶ä¼ è¾“åè®®#cite_note-nurdle-13)ã€‚1999å¹´5æœˆå‘å¸ƒçš„[RFC](https://zh.wikipedia.org/wiki/RFC) [2577](https://tools.ietf.org/html/rfc2577)ä¸­åˆ—å‡ºäº†ä»¥ä¸‹å‡ ä¸ªä¸»è¦çš„æ¼æ´ï¼š

+ [æš´åŠ›ç ´è§£](https://zh.wikipedia.org/wiki/æš´åŠ›ç ´è§£)
+ [FTPåå¼¹æ”»å‡»](https://zh.wikipedia.org/w/index.php?title=FTPåå¼¹æ”»å‡»&action=edit&redlink=1)
+ [æ•°æ®åŒ…æ•è·](https://zh.wikipedia.org/wiki/æ•¸æ“šåŒ…åˆ†æå™¨)
+ ç«¯å£çªƒå–ï¼ˆçŒœæµ‹ä¸‹ä¸€ä¸ªå¼€æ”¾ç«¯å£å¹¶ç¯¡å¤ºåˆæ³•è¿æ¥ï¼‰
+ [æ¬ºéª—æ”»å‡»](https://zh.wikipedia.org/wiki/æ¬ºéª—æ”»å‡»)
+ [ç”¨æˆ·å](https://zh.wikipedia.org/wiki/ç”¨æˆ·)æšä¸¾

é€šè¿‡FTPä¼ è¾“çš„æµé‡ä¸ä¼šè¢«åŠ å¯†ï¼Œæ‰€æœ‰ä¼ è¾“é€šè¿‡æ˜æ–‡è¿›è¡Œçš„ã€‚ä»»ä½•èƒ½å¤Ÿåœ¨ç½‘ç»œä¸Šæ‰§è¡Œæ•°æ®åŒ…æ•è·ï¼ˆ [å—…æ¢](https://zh.wikipedia.org/wiki/æ•¸æ“šåŒ…åˆ†æå™¨) ï¼‰çš„äººéƒ½å¯ä»¥è¯»å–ç”¨æˆ·åã€å¯†ç ã€å‘½ä»¤å†…å®¹å’Œæ•°æ®[[14\]](https://zh.wikipedia.org/wiki/æ–‡ä»¶ä¼ è¾“åè®®#cite_note-tcpip-14)[[15\]](https://zh.wikipedia.org/wiki/æ–‡ä»¶ä¼ è¾“åè®®#cite_note-nurdle2-15)ã€‚



### å¸¸è§FTPå‘½ä»¤

![img](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203300844598.png)

### å¸¸è§FTPå“åº”ç 

![img](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203300844332.png)

| å“åº”ç  | ä¿¡æ¯                   |
| ------ | ---------------------- |
| 150    | æ‰“å¼€è¿æ¥               |
| 200    | æˆåŠŸ                   |
| 211    | ç³»ç»ŸçŠ¶æ€å›å¤           |
| 213    | æ–‡ä»¶çŠ¶æ€å›å¤           |
| 227    | è¿›å…¥è¢«åŠ¨æ¨¡å¼(IP, port) |
| 421    | æœåŠ¡å…³é—­               |
| 450    | æ–‡ä»¶ä¸å¯ç”¨             |
| 452    | ç£ç›˜ç©ºé—´ä¸è¶³           |
| 500    | æ— æ•ˆå‘½ä»¤               |
| 501    | é”™è¯¯å‚æ•°               |
| 550    | æ–‡ä»¶ä¸å¯ç”¨             |







## FTP æŠ¥æ–‡åˆ†æ

### FTPæœåŠ¡å™¨é…ç½®

#### **åŸºäºè…¾è®¯äº‘æœåŠ¡å™¨æ­å»ºFTPæœåŠ¡å™¨**

æœåŠ¡å™¨ç¡¬ä»¶ä¿¡æ¯

<img src="https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/image-20220329224247835.png" alt="image-20220329224247835" style="zoom:50%;" />

æœåŠ¡å™¨æ­è½½çš„æ˜¯ Ubuntu Server 18.04.1 LTS 64bit

![image-20220329223636298](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203300854839.png)



#### å®‰è£…vsftpd

<img src="https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203300803241.png" alt="æˆªå±2022-03-17 22.46.10" style="zoom: 50%;" />



#### vsftpdé…ç½®

<img src="https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203300825787.png" alt="image-20220330082551674" style="zoom:67%;" />

+ listen=YES  ç›‘å¬IPv4è¯·æ±‚
+ listen_ipv6=NO ä¸ç›‘å¬IPv6è¯·æ±‚
+ anonymous_enable = YES å…è®¸åŒ¿åè®¿é—®
+ local_enable = YES å…è®¸æœ¬åœ°ç”¨æˆ·ç™»å½•
+ write_enable = YES å…è®¸å†™å…¥æ–‡ä»¶
+ local_umask = 022 umaskæƒé™022 å…è®¸è¯»å†™
+ dirmessage_enable = YES  ç”¨æˆ·åˆ‡æ¢ç›®å½•æ—¶ä¼šå‘å…¶å‘é€æ¶ˆæ¯
+ use_loacltime = ä½¿ç”¨ä¸»æœºæ—¶é—´
+ xferlog_enable = YES  æ‰“å¼€æ—¥å¿—è®°å½•
+ connect_from_port_20  = YES ä½¿ç”¨20ç«¯å£
+ pasv_enable = YES å¯åŠ¨è¢«åŠ¨æ¨¡å¼
+ pasv_min_port = 10000 æœ€å°ç«¯å£
+ pasv_max_port = 11000 æœ€å¤§ç«¯å£
+ local_root = /home/ftpfile è®¾ç½®æ ¹ç›®å½•
+ userlist_enable = YES ä½¿ç”¨userlistå­˜å‚¨ç”¨æˆ·ä¿¡æ¯
+ ftpd_banner  ç™»å½•æ—¶çš„æ¬¢è¿è¯­å¥



#### æœåŠ¡å™¨é˜²ç«å¢™é…ç½®

åœ¨é˜²ç«å¢™ä¸­å…è®¸ä½¿ç”¨æœåŠ¡å™¨çš„20å’Œ21ç«¯å£ï¼Œæ‰“å¼€10000ï½11000ç«¯å£ç”¨äºæ•°æ®ä¼ è¾“

![æˆªå±2022-03-19 10.14.27](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/%E6%88%AA%E5%B1%8F2022-03-19%2010.14.27.png)

![æˆªå±2022-03-29 22.31.32](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/%E6%88%AA%E5%B1%8F2022-03-29%2022.31.32.png)



#### æœåŠ¡å™¨ç«¯å£ä¿¡æ¯

![image-20220329225009117](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/image-20220329225009117.png)



#### æ·»åŠ ç”¨æˆ·

![æˆªå±2022-03-19 10.07.24](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203300804103.png)



#### ç™»å½•æµ‹è¯•

![image-20220330082715869](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203300827971.png)

è‡³æ­¤ï¼ŒFTPæœåŠ¡æ­å»ºå®Œæˆ





### FTP-CLI

ä½¿ç”¨æœ¬åœ°PCè¿œç¨‹è®¿é—®æœåŠ¡å™¨

![iShot2022-03-30 08.08.38](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203300900655.png)

æŸ¥çœ‹æ ¹ç›®å½•ä¸‹æ–‡ä»¶ä¿¡æ¯

![iShot2022-03-30 08.08.58](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203300900127.png)

åœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåä¸ºtest

![image-20220330090206945](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203300902032.png)

ä»æœåŠ¡å™¨ä¸‹è½½test.txtæ–‡ä»¶

![iShot2022-03-30 08.09.38](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203300904737.png)



### æŠ“åŒ…åˆ†æ

ä¸‰æ¬¡æ¡æ‰‹ğŸ¤ å»ºç«‹TCPè¿æ¥

![image-20220330094433045](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203300944314.png)



#### å»ºç«‹è¿æ¥

![image-20220330094619180](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203300946291.png)

æœåŠ¡å™¨çš„21ç«¯å£ä¸æœ¬æœºçš„53012ç«¯å£å»ºç«‹é€šä¿¡

+ Response code: Service ready for user (220)  æœåŠ¡å‡†å¤‡å°±ç»ª
+ Response arg: (vsFTP 3.0.3)

<img src="https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301518054.png" alt="image-20220330151830433" style="zoom: 67%;" />

Response: 530 Please login with USER and PASS.
ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç ç™»å½•

<img src="https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301520240.png" alt="image-20220330152027115" style="zoom:67%;" />

+ Request: USER pqq
+ ç”¨æˆ·åï¼špqq

![image-20220330152140187](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301521283.png)

Response: Please specify the password.
è¾“å…¥å¯†ç 

![image-20220330152243063](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301522151.png)

+ Requestï¼šPASS Pqq12138



![image-20220330152507652](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301525739.png)

+ Responseï¼šLogin successful.
  ç™»å½•æˆåŠŸ

![image-20220330152613213](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301526291.png)

ä¸»æœºæ”¶åˆ°ç™»å½•æˆåŠŸçš„æŠ¥æ–‡åï¼Œå‘æœåŠ¡å™¨å›å¤äº†ä¸€ä¸ªç¡®è®¤æŠ¥æ–‡

> é€šè¿‡è¿™ä¸¤ä¸ªæŠ¥æ–‡å¯å¾—çŸ¥ï¼Œåœ¨ç™»å½•çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹è´¦å·å’Œå¯†ç å¹¶æ²¡æœ‰åŠ å¯†ï¼Œé€šè¿‡æ•è·æŠ¥æ–‡å¯ä»¥ç›´æ¥çœ‹åˆ°ç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå­˜åœ¨å®‰å…¨éšæ‚£ã€‚



#### FTPæ“ä½œ

##### æ›´æ¢å·¥ä½œè·¯å¾„

<img src="https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301527880.png" alt="image-20220330152739764" style="zoom:67%;" />

+ Request: CWD /

  Change Work  Directory  æ›´æ”¹å·¥ä½œè·¯å¾„

<img src="https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301534582.png" alt="image-20220330153437443" style="zoom:50%;" />

+ REsponse: 250 Directory  successfully changed.



##### åˆ‡æ¢ä¼ è¾“æ¨¡å¼

![image-20220330153702613](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301537703.png)

+ Requesï¼šTYPE A

  è¯·æ±‚åˆ‡æ¢åˆ°ASC II ä¼ è¾“æ¨¡å¼

<img src="https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301543152.png" alt="image-20220330154317017" style="zoom:150%;" />

+ Responseï¼š200 Switching to ASCII mode



##### å¯ç”¨è¢«åŠ¨æ¨¡å¼

![image-20220330154838233](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301548322.png)

+ Request : PASV

![image-20220330154911348](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301549475.png)

+ Response: 227 Entering Passive Mode (121,5,22,41,55).
+ $41*256 + 55=10551$  å°†åœ¨æœåŠ¡å™¨çš„10551ç«¯å£ä¸Šè¿›è¡Œæ•°æ®ä¼ è¾“

##### åˆ—å‡ºæ–‡ä»¶

<img src="https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301603033.png" alt="image-20220330160344944" style="zoom:67%;" />

+ Request: LIST

  

![image-20220330160611555](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301606617.png)

+ Response: 150 Here comes  the directory  listing.

![image-20220330160624375](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301606444.png)

+ TCPæŠ¥æ–‡: Src Port :  10282, Dst Port:  53015

![](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301605507.png)

+  Response: 226 Directory send OK.

å®¢æˆ·ç«¯è¯·æ±‚LISTå‘½ä»¤ï¼ŒæœåŠ¡å™¨ä¸€ä¸ªå‘é€äº†ä¸‰ä¸ªæŠ¥æ–‡ï¼š

1. 150 æ‰“å¼€è¿æ¥
2. TCP æŠ¥æ–‡ä¼ è¾“æ•°æ®
3. 226 ç»“æŸæ•°æ®è¿æ¥



##### 



##### ä¸‹è½½æ–‡ä»¶

<img src="https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301600892.png" alt="image-20220330160046753" style="zoom: 67%;" />

+ Request: RETR test.txt

##### ä¸Šä¼ æ–‡ä»¶

<img src="https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301612558.png" alt="image-20220330161252471" style="zoom:67%;" />

+ Requestï¼š STOR test.txt

  



##### é‡å‘½åæ–‡ä»¶

<img src="https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301807729.png" alt="image-20220330180703391" style="zoom: 67%;" />

+ Request:  RNFR text.txt

<img src="https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301808460.png" alt="image-20220330180853350" style="zoom:67%;" />

+ Response: 350 Read for RNTO

<img src="https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301810810.png" alt="image-20220330181050657" style="zoom:67%;" />

+ Request:  RNTO  newname.txt

![image-20220330181143806](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301811901.png)

+  Response: 250 Rename successful

  ä¿®æ”¹æ–‡ä»¶åæˆåŠŸ

![image-20220330181713273](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301817395.png)

å®¢æˆ·ç«¯æ”¶åˆ°ä¸»æœºçš„250æˆåŠŸä¿¡æ¯åå›å¤ä¸€ä¸ªTCPç¡®è®¤æŠ¥æ–‡



##### åˆ é™¤æ–‡ä»¶

<img src="https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301818310.png" alt="image-20220330181835205" style="zoom:67%;" />

+ Request: DELE newname.txt

<img src="https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301821798.png" alt="image-20220330182103691" style="zoom: 50%;" />

+ Response: 250  Delete operation successful.



![image-20220330182216555](https://pele-images.oss-cn-hangzhou.aliyuncs.com/images/202203301822665.png)

+ æ–­å¼€21ç«¯å£çš„TCPè¿æ¥
